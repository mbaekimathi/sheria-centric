{% extends "base.html" %}

{% block title %}My Profile - CASELY{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Profile Header -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mb-6">
        <div class="bg-gradient-to-r from-green-600 to-orange-500 p-8">
            <div class="flex flex-col md:flex-row items-center md:items-end space-y-4 md:space-y-0 md:space-x-6">
                <!-- Profile Picture -->
                <div class="relative">
                    {% if employee.profile_picture %}
                    <div class="w-32 h-32 rounded-2xl border-4 border-white shadow-xl overflow-hidden">
                        <img src="{{ url_for('static', filename='uploads/profile_pictures/' + employee.profile_picture) }}" 
                             alt="Profile" class="w-full h-full object-cover">
                    </div>
                    {% else %}
                    <div class="w-32 h-32 rounded-2xl border-4 border-white shadow-xl bg-white flex items-center justify-center">
                        <i class="fas fa-user text-green-600 text-5xl"></i>
                    </div>
                    {% endif %}
                    <div class="absolute -bottom-2 -right-2 w-10 h-10 rounded-full bg-green-600 border-4 border-white flex items-center justify-center shadow-lg">
                        <i class="fas fa-check text-white text-sm"></i>
                    </div>
                </div>
                
                <!-- Profile Info -->
                <div class="flex-1 text-center md:text-left">
                    <h1 class="text-3xl font-bold text-white mb-2">{{ employee.full_name }}</h1>
                    {% if is_role_switched and switched_role %}
                    <div class="mb-3 px-4 py-2 bg-orange-500/30 backdrop-blur-sm rounded-lg border border-orange-300/50 inline-flex items-center">
                        <i class="fas fa-exchange-alt text-orange-200 mr-2"></i>
                        <span class="text-white font-semibold text-sm">Visiting as: <span class="text-orange-200">{{ switched_role }}</span></span>
                    </div>
                    {% endif %}
                    <div class="flex flex-wrap items-center justify-center md:justify-start gap-3">
                        <span class="px-4 py-1.5 bg-white/20 backdrop-blur-sm rounded-full text-white text-sm font-semibold">
                            <i class="fas fa-user-tag mr-2"></i>{{ employee.role }}
                        </span>
                        <span class="px-4 py-1.5 bg-white/20 backdrop-blur-sm rounded-full text-white text-sm font-semibold">
                            <i class="fas fa-building mr-2"></i>{{ company_settings.company_name if company_settings else 'BAUNI LAW GROUP' }}
                        </span>
                        <span class="px-4 py-1.5 rounded-full text-sm font-semibold {% if employee.status == 'Active' %}bg-green-500 text-white{% elif employee.status == 'Pending Approval' %}bg-yellow-500 text-white{% else %}bg-red-500 text-white{% endif %}">
                            {{ employee.status }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Details -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Personal Information -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                <i class="fas fa-user-circle text-green-600 mr-3"></i>
                Personal Information
            </h2>
            <div class="space-y-4">
                <div class="flex items-start space-x-4 pb-4 border-b border-gray-100">
                    <div class="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-id-card text-green-600"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-xs text-gray-500 font-medium mb-1">Employee Code</p>
                        <p class="text-lg font-bold text-gray-900">{{ employee.employee_code }}</p>
                    </div>
                </div>
                
                <div class="flex items-start space-x-4 pb-4 border-b border-gray-100">
                    <div class="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-user text-green-600"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-xs text-gray-500 font-medium mb-1">Full Name</p>
                        <p class="text-lg font-semibold text-gray-900">{{ employee.full_name }}</p>
                    </div>
                </div>
                
                <div class="flex items-start space-x-4 pb-4 border-b border-gray-100">
                    <div class="w-10 h-10 rounded-lg bg-orange-100 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-phone text-orange-600"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-xs text-gray-500 font-medium mb-1">Phone Number</p>
                        <p class="text-lg font-semibold text-gray-900">{{ employee.phone_number }}</p>
                    </div>
                </div>
                
                <div class="flex items-start space-x-4">
                    <div class="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-envelope text-green-600"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-xs text-gray-500 font-medium mb-1">Work Email</p>
                        <p class="text-lg font-semibold text-gray-900 break-all">{{ employee.work_email }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Information -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                <i class="fas fa-info-circle text-orange-600 mr-3"></i>
                Account Information
            </h2>
            <div class="space-y-4">
                <div class="flex items-start space-x-4 pb-4 border-b border-gray-100">
                    <div class="w-10 h-10 rounded-lg bg-orange-100 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-user-tag text-orange-600"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-xs text-gray-500 font-medium mb-1">Role</p>
                        <p class="text-lg font-semibold text-gray-900">{{ employee.role }}</p>
                    </div>
                </div>
                
                <div class="flex items-start space-x-4 pb-4 border-b border-gray-100">
                    <div class="w-10 h-10 rounded-lg {% if employee.status == 'Active' %}bg-green-100{% elif employee.status == 'Pending Approval' %}bg-yellow-100{% else %}bg-red-100{% endif %} flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-info-circle {% if employee.status == 'Active' %}text-green-600{% elif employee.status == 'Pending Approval' %}text-yellow-600{% else %}text-red-600{% endif %}"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-xs text-gray-500 font-medium mb-1">Account Status</p>
                        <p class="text-lg font-semibold {% if employee.status == 'Active' %}text-green-600{% elif employee.status == 'Pending Approval' %}text-yellow-600{% else %}text-red-600{% endif %}">
                            {{ employee.status }}
                        </p>
                    </div>
                </div>
                
                <div class="flex items-start space-x-4 pb-4 border-b border-gray-100">
                    <div class="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-building text-green-600"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-xs text-gray-500 font-medium mb-1">Company</p>
                        <p class="text-lg font-semibold text-gray-900">{{ company_settings.company_name if company_settings else 'BAUNI LAW GROUP' }}</p>
                    </div>
                </div>
                
                <div class="flex items-start space-x-4">
                    <div class="w-10 h-10 rounded-lg bg-orange-100 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-calendar text-orange-600"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-xs text-gray-500 font-medium mb-1">Account Created</p>
                        <p class="text-lg font-semibold text-gray-900">{{ employee.created_at.strftime('%B %d, %Y') }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="mt-6 flex flex-col sm:flex-row gap-4">
        <button onclick="toggleEditMode()" id="editBtn" class="flex-1 px-6 py-3 bg-gradient-to-r from-orange-600 to-orange-700 text-white font-semibold rounded-xl hover:from-orange-700 hover:to-orange-800 transition-all duration-300 shadow-lg hover:shadow-xl text-center">
            <i class="fas fa-edit mr-2"></i>Edit Profile
        </button>
        <a href="{{ url_for('dashboard') }}" class="flex-1 px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white font-semibold rounded-xl hover:from-green-700 hover:to-green-800 transition-all duration-300 shadow-lg hover:shadow-xl text-center">
            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
        </a>
    </div>

    <!-- Edit Profile Form -->
    <form id="editProfileForm" method="POST" action="{{ url_for('update_profile') }}" enctype="multipart/form-data" class="hidden">
        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 mt-6">
            <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                <i class="fas fa-edit text-orange-600 mr-3"></i>
                Edit Profile Information
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Profile Picture Upload -->
                <div class="md:col-span-2">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-image mr-2 text-green-600"></i>Profile Picture
                    </label>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            {% if employee.profile_picture %}
                            <div class="w-24 h-24 rounded-xl border-2 border-gray-200 overflow-hidden">
                                <img id="profilePreview" src="{{ url_for('static', filename='uploads/profile_pictures/' + employee.profile_picture) }}" 
                                     alt="Profile" class="w-full h-full object-cover">
                            </div>
                            {% else %}
                            <div id="profilePreviewContainer" class="w-24 h-24 rounded-xl border-2 border-gray-200 bg-gray-100 flex items-center justify-center">
                                <i class="fas fa-user text-gray-400 text-3xl"></i>
                            </div>
                            {% endif %}
                        </div>
                        <div class="flex-1">
                            <input type="file" name="profile_picture" id="profile_picture" accept="image/*" 
                                   class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100 file:cursor-pointer border border-gray-300 rounded-lg p-2" 
                                   onchange="previewImage(this)">
                            <p class="text-xs text-gray-500 mt-1">JPG, PNG or GIF (Max 16MB)</p>
                        </div>
                    </div>
                </div>

                <!-- Full Name -->
                <div>
                    <label for="full_name" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-user text-green-600 mr-2"></i>Full Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="full_name" id="full_name" value="{{ employee.full_name }}" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all">
                </div>

                <!-- Phone Number -->
                <div>
                    <label for="phone_number" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-phone text-orange-600 mr-2"></i>Phone Number <span class="text-red-500">*</span>
                    </label>
                    <input type="tel" name="phone_number" id="phone_number" value="{{ employee.phone_number }}" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all">
                </div>

                <!-- Work Email -->
                <div>
                    <label for="work_email" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-envelope text-green-600 mr-2"></i>Work Email <span class="text-red-500">*</span>
                    </label>
                    <input type="email" name="work_email" id="work_email" value="{{ employee.work_email }}" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all">
                </div>

                <!-- Employee Code (Read-only) -->
                <div>
                    <label for="employee_code" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-id-card text-green-600 mr-2"></i>Employee Code
                    </label>
                    <input type="text" name="employee_code" id="employee_code" value="{{ employee.employee_code }}" 
                           readonly disabled
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100 text-gray-600 cursor-not-allowed">
                    <p class="text-xs text-gray-500 mt-1">Employee code cannot be changed</p>
                </div>
            </div>

            <!-- Password Change Section -->
            <div class="mt-6 pt-6 border-t border-gray-200">
                <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-lock text-orange-600 mr-3"></i>
                    Change Password
                </h3>
                <p class="text-sm text-gray-600 mb-4">Leave password fields empty if you don't want to change your password</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Current Password -->
                    <div>
                        <label for="current_password" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-key text-green-600 mr-2"></i>Current Password
                        </label>
                        <input type="password" name="current_password" id="current_password" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all"
                               placeholder="Enter current password">
                    </div>

                    <!-- New Password -->
                    <div>
                        <label for="new_password" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-lock text-orange-600 mr-2"></i>New Password
                        </label>
                        <input type="password" name="new_password" id="new_password" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all"
                               placeholder="Enter new password (min 6 characters)">
                        <p class="text-xs text-gray-500 mt-1">Minimum 6 characters</p>
                    </div>

                    <!-- Confirm New Password -->
                    <div class="md:col-span-2">
                        <label for="confirm_password" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-check-circle text-green-600 mr-2"></i>Confirm New Password
                        </label>
                        <input type="password" name="confirm_password" id="confirm_password" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all"
                               placeholder="Confirm new password">
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="mt-6 flex flex-col sm:flex-row gap-4">
                <button type="submit" class="flex-1 px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white font-semibold rounded-xl hover:from-green-700 hover:to-green-800 transition-all duration-300 shadow-lg hover:shadow-xl">
                    <i class="fas fa-save mr-2"></i>Save Changes
                </button>
                <button type="button" onclick="toggleEditMode()" class="flex-1 px-6 py-3 bg-gray-500 text-white font-semibold rounded-xl hover:bg-gray-600 transition-all duration-300 shadow-lg hover:shadow-xl">
                    <i class="fas fa-times mr-2"></i>Cancel
                </button>
            </div>
        </div>
    </form>
</div>

<script>
    function toggleEditMode() {
        const viewMode = document.querySelector('.grid.grid-cols-1.md\\:grid-cols-2.gap-6');
        const editForm = document.getElementById('editProfileForm');
        const editBtn = document.getElementById('editBtn');
        
        if (editForm.classList.contains('hidden')) {
            // Switch to edit mode
            viewMode.style.display = 'none';
            editForm.classList.remove('hidden');
            editBtn.innerHTML = '<i class="fas fa-eye mr-2"></i>View Profile';
            editBtn.classList.remove('from-orange-600', 'to-orange-700', 'hover:from-orange-700', 'hover:to-orange-800');
            editBtn.classList.add('from-gray-600', 'to-gray-700', 'hover:from-gray-700', 'hover:to-gray-800');
        } else {
            // Switch to view mode
            viewMode.style.display = 'grid';
            editForm.classList.add('hidden');
            editBtn.innerHTML = '<i class="fas fa-edit mr-2"></i>Edit Profile';
            editBtn.classList.remove('from-gray-600', 'to-gray-700', 'hover:from-gray-700', 'hover:to-gray-800');
            editBtn.classList.add('from-orange-600', 'to-orange-700', 'hover:from-orange-700', 'hover:to-orange-800');
        }
    }

    function previewImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                let preview = document.getElementById('profilePreview');
                let container = document.getElementById('profilePreviewContainer');
                
                if (preview) {
                    preview.src = e.target.result;
                } else if (container) {
                    // Replace placeholder with image
                    container.innerHTML = `<img id="profilePreview" src="${e.target.result}" alt="Profile" class="w-full h-full object-cover">`;
                }
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
{% endblock %}

