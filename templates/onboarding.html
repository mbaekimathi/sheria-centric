{% extends "base.html" %}

{% block title %}Employee Onboarding - SHERIA CENTRIC{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Page Header -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 mb-6">
        <div class="text-center">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-orange-500/20 backdrop-blur-sm mb-4">
                <i class="fas fa-clipboard-check text-orange-600 text-2xl"></i>
            </div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Employee Onboarding</h1>
            <p class="text-gray-600">Please complete your onboarding information</p>
        </div>
    </div>

    <!-- Onboarding Form -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8">
        <form method="POST" action="{{ url_for('submit_onboarding') }}" enctype="multipart/form-data" class="space-y-8">
            <!-- Payroll & Compensation Details Section -->
            <div class="border-b border-gray-200 pb-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-2 flex items-center">
                    <i class="fas fa-money-bill-wave text-green-600 mr-3"></i>
                    Payroll & Compensation Details
                </h2>
                <p class="text-sm text-gray-500 mb-6">All fields are required</p>
                
                <div class="space-y-6">
                    <!-- Tax PIN - First Field -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="md:col-span-2">
                            <label for="tax_pin" class="block text-sm font-semibold text-gray-700 mb-2">
                                Tax PIN <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                    <i class="fas fa-id-card text-gray-400"></i>
                                </div>
                                <input 
                                    type="text" 
                                    id="tax_pin" 
                                    name="tax_pin" 
                                    required
                                    class="w-full pl-11 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all outline-none text-gray-900 placeholder-gray-400"
                                    placeholder="Enter tax PIN"
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method Selection -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="md:col-span-2">
                            <label for="payment_method" class="block text-sm font-semibold text-gray-700 mb-2">
                                Payment Method <span class="text-red-500">*</span>
                            </label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Bank Option -->
                                <label class="relative flex items-center p-4 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 transition-all payment-method-option" data-method="Bank">
                                    <input 
                                        type="radio" 
                                        name="payment_method" 
                                        value="Bank" 
                                        id="payment_method_bank"
                                        required
                                        class="sr-only payment-method-radio"
                                        onchange="handlePaymentMethodChange()"
                                    >
                                    <div class="flex items-center w-full">
                                        <div class="flex-shrink-0 w-5 h-5 border-2 border-gray-400 rounded-full mr-3 flex items-center justify-center payment-method-check">
                                            <div class="w-3 h-3 bg-blue-600 rounded-full hidden payment-method-dot"></div>
                                        </div>
                                        <div class="flex-1">
                                            <div class="flex items-center">
                                                <i class="fas fa-university text-blue-600 text-xl mr-3"></i>
                                                <span class="font-semibold text-gray-900">Bank</span>
                                            </div>
                                            <p class="text-xs text-gray-500 mt-1">Direct bank transfer</p>
                                        </div>
                                    </div>
                                </label>

                                <!-- Mobile Money Option -->
                                <label class="relative flex items-center p-4 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-purple-500 transition-all payment-method-option" data-method="Mobile Money">
                                    <input 
                                        type="radio" 
                                        name="payment_method" 
                                        value="Mobile Money" 
                                        id="payment_method_mobile"
                                        required
                                        class="sr-only payment-method-radio"
                                        onchange="handlePaymentMethodChange()"
                                    >
                                    <div class="flex items-center w-full">
                                        <div class="flex-shrink-0 w-5 h-5 border-2 border-gray-400 rounded-full mr-3 flex items-center justify-center payment-method-check">
                                            <div class="w-3 h-3 bg-purple-600 rounded-full hidden payment-method-dot"></div>
                                        </div>
                                        <div class="flex-1">
                                            <div class="flex items-center">
                                                <i class="fas fa-mobile-alt text-purple-600 text-xl mr-3"></i>
                                                <span class="font-semibold text-gray-900">Mobile Money</span>
                                            </div>
                                            <p class="text-xs text-gray-500 mt-1">M-Pesa, Airtel Money, etc.</p>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Bank Details Section -->
                    <div id="bank-details-section" class="hidden bg-blue-50 border-2 border-blue-200 rounded-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-university text-blue-600 mr-2"></i>
                            Bank Details
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Bank Name -->
                            <div>
                                <label for="bank_name" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Bank Name <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <i class="fas fa-landmark text-blue-400"></i>
                                    </div>
                                    <input 
                                        type="text" 
                                        id="bank_name" 
                                        name="bank_name" 
                                        class="w-full pl-11 pr-4 py-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none text-gray-900 placeholder-gray-400 bg-white"
                                        placeholder="Enter bank name (e.g., Equity Bank, KCB)"
                                    >
                                </div>
                            </div>

                            <!-- Account Name -->
                            <div>
                                <label for="account_name" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Account Name <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <i class="fas fa-user text-blue-400"></i>
                                    </div>
                                    <input 
                                        type="text" 
                                        id="account_name" 
                                        name="account_name" 
                                        class="w-full pl-11 pr-4 py-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none text-gray-900 placeholder-gray-400 bg-white"
                                        placeholder="Enter account holder name"
                                    >
                                </div>
                            </div>

                            <!-- Account Number -->
                            <div class="md:col-span-2">
                                <label for="account_number" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Account Number <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <i class="fas fa-hashtag text-blue-400"></i>
                                    </div>
                                    <input 
                                        type="text" 
                                        id="account_number" 
                                        name="account_number" 
                                        class="w-full pl-11 pr-4 py-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none text-gray-900 placeholder-gray-400 bg-white"
                                        placeholder="Enter bank account number"
                                    >
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile Money Details Section -->
                    <div id="mobile-money-details-section" class="hidden bg-purple-50 border-2 border-purple-200 rounded-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-mobile-alt text-purple-600 mr-2"></i>
                            Mobile Money Details
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Mobile Money Company -->
                            <div>
                                <label for="mobile_money_company" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Mobile Money Company <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <i class="fas fa-building text-purple-400"></i>
                                    </div>
                                    <input 
                                        type="text" 
                                        id="mobile_money_company" 
                                        name="mobile_money_company" 
                                        class="w-full pl-11 pr-4 py-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all outline-none text-gray-900 placeholder-gray-400 bg-white"
                                        placeholder="Enter company name (e.g., M-Pesa, Airtel Money)"
                                    >
                                </div>
                            </div>

                            <!-- Account Name -->
                            <div>
                                <label for="account_name_mobile" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Account Name <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <i class="fas fa-user text-purple-400"></i>
                                    </div>
                                    <input 
                                        type="text" 
                                        id="account_name_mobile" 
                                        name="account_name" 
                                        class="w-full pl-11 pr-4 py-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all outline-none text-gray-900 placeholder-gray-400 bg-white"
                                        placeholder="Enter account holder name"
                                    >
                                </div>
                            </div>

                            <!-- Account Number (Phone Number) -->
                            <div class="md:col-span-2">
                                <label for="account_number_mobile" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Phone Number / Account Number <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <i class="fas fa-phone text-purple-400"></i>
                                    </div>
                                    <input 
                                        type="text" 
                                        id="account_number_mobile" 
                                        name="account_number" 
                                        class="w-full pl-11 pr-4 py-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all outline-none text-gray-900 placeholder-gray-400 bg-white"
                                        placeholder="Enter mobile money phone number"
                                    >
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Compliance & Agreements Section -->
            <div class="border-b border-gray-200 pb-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-2 flex items-center">
                    <i class="fas fa-file-contract text-orange-600 mr-3"></i>
                    Compliance & Agreements
                </h2>
                <p class="text-sm text-gray-500 mb-6">All agreements must be accepted</p>
                
                <div class="space-y-6">
                    <!-- Employee Contract Download Section -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h3 class="text-lg font-bold text-gray-900 mb-2 flex items-center">
                                    <i class="fas fa-file-download text-blue-600 mr-2"></i>
                                    Employee Contract
                                </h3>
                                {% if has_contract %}
                                <p class="text-sm text-gray-600 mb-4">
                                    You have already uploaded your employment contract. You can download it here for your records.
                                </p>
                                <a href="{{ url_for('download_employee_contract') }}" 
                                   class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 active:scale-[0.98] transition-all duration-200 shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                    <i class="fas fa-download mr-2"></i>
                                    Download My Contract
                                </a>
                                {% else %}
                                <p class="text-sm text-gray-600 mb-4">
                                    Please obtain your employment contract from HR or your administrator. Once you have the contract file, you can upload it below.
                                </p>
                                <div class="flex items-center text-sm text-blue-700">
                                    <i class="fas fa-info-circle mr-2"></i>
                                    <span>Contact HR if you need a copy of your contract</span>
                                </div>
                                {% endif %}
                            </div>
                            <div class="ml-4">
                                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-file-contract text-blue-600 text-2xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Employment Contract Upload -->
                    <div>
                        <label for="employment_contract" class="block text-sm font-semibold text-gray-700 mb-2">
                            Employment Contract Upload <span class="text-red-500">*</span>
                        </label>
                        <div class="flex items-center space-x-4">
                            <div class="flex-1">
                                <input 
                                    type="file" 
                                    id="employment_contract" 
                                    name="employment_contract" 
                                    accept=".pdf,.doc,.docx"
                                    required
                                    class="hidden"
                                    onchange="previewContractFile(this)"
                                >
                                <label 
                                    for="employment_contract" 
                                    class="cursor-pointer flex items-center justify-center px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-all duration-200 text-sm text-gray-600"
                                >
                                    <i class="fas fa-upload mr-2"></i>
                                    <span id="contract-file-name">Choose file or drag and drop</span>
                                </label>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-1.5 ml-1">PDF, DOC, DOCX up to 10MB</p>
                    </div>

                    <!-- ID/Passport Front Upload -->
                    <div>
                        <label for="id_front" class="block text-sm font-semibold text-gray-700 mb-2">
                            Identification Card / Passport (Front) <span class="text-red-500">*</span>
                        </label>
                        <div class="flex items-center space-x-4">
                            <div class="flex-1">
                                <input 
                                    type="file" 
                                    id="id_front" 
                                    name="id_front" 
                                    accept="image/*,.pdf"
                                    required
                                    class="hidden"
                                    onchange="previewIdFile(this, 'front')"
                                >
                                <label 
                                    for="id_front" 
                                    class="cursor-pointer flex items-center justify-center px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-all duration-200 text-sm text-gray-600"
                                >
                                    <i class="fas fa-upload mr-2"></i>
                                    <span id="id-front-file-name">Choose file or drag and drop</span>
                                </label>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-1.5 ml-1">Image (JPG, PNG) or PDF up to 10MB</p>
                    </div>

                    <!-- ID/Passport Back Upload -->
                    <div>
                        <label for="id_back" class="block text-sm font-semibold text-gray-700 mb-2">
                            Identification Card / Passport (Back) <span class="text-red-500">*</span>
                        </label>
                        <div class="flex items-center space-x-4">
                            <div class="flex-1">
                                <input 
                                    type="file" 
                                    id="id_back" 
                                    name="id_back" 
                                    accept="image/*,.pdf"
                                    required
                                    class="hidden"
                                    onchange="previewIdFile(this, 'back')"
                                >
                                <label 
                                    for="id_back" 
                                    class="cursor-pointer flex items-center justify-center px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-all duration-200 text-sm text-gray-600"
                                >
                                    <i class="fas fa-upload mr-2"></i>
                                    <span id="id-back-file-name">Choose file or drag and drop</span>
                                </label>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-1.5 ml-1">Image (JPG, PNG) or PDF up to 10MB</p>
                    </div>

                </div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-end space-x-4 pt-6">
                <button 
                    type="submit"
                    class="px-8 py-3.5 bg-orange-500 text-white font-semibold rounded-lg hover:bg-orange-600 active:scale-[0.98] transition-all duration-200 shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2"
                >
                    <i class="fas fa-check-circle mr-2"></i>Submit Onboarding Information
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    function previewContractFile(input) {
        const fileName = document.getElementById('contract-file-name');
        if (input.files && input.files[0]) {
            fileName.textContent = input.files[0].name;
        } else {
            fileName.textContent = 'Choose file or drag and drop';
        }
    }

    function previewIdFile(input, side) {
        const fileName = document.getElementById(`id-${side}-file-name`);
        if (input.files && input.files[0]) {
            fileName.textContent = input.files[0].name;
        } else {
            fileName.textContent = 'Choose file or drag and drop';
        }
    }

    function handlePaymentMethodChange() {
        const bankRadio = document.getElementById('payment_method_bank');
        const mobileRadio = document.getElementById('payment_method_mobile');
        const bankSection = document.getElementById('bank-details-section');
        const mobileSection = document.getElementById('mobile-money-details-section');
        
        // Update radio button visual states
        document.querySelectorAll('.payment-method-option').forEach(option => {
            const radio = option.querySelector('.payment-method-radio');
            const check = option.querySelector('.payment-method-check');
            const dot = option.querySelector('.payment-method-dot');
            
            if (radio.checked) {
                option.classList.add('border-2');
                check.classList.add('border-2');
                dot.classList.remove('hidden');
                if (radio.value === 'Bank') {
                    option.classList.remove('border-gray-300', 'border-purple-500');
                    option.classList.add('border-blue-500', 'bg-blue-50');
                } else {
                    option.classList.remove('border-gray-300', 'border-blue-500');
                    option.classList.add('border-purple-500', 'bg-purple-50');
                }
            } else {
                option.classList.remove('border-2', 'border-blue-500', 'border-purple-500', 'bg-blue-50', 'bg-purple-50');
                option.classList.add('border-gray-300');
                check.classList.remove('border-2');
                check.classList.add('border-gray-400');
                dot.classList.add('hidden');
            }
        });
        
        // Show/hide sections and set required fields
        if (bankRadio.checked) {
            bankSection.classList.remove('hidden');
            mobileSection.classList.add('hidden');
            
            // Set required fields for bank and enable them
            const bankNameField = document.getElementById('bank_name');
            const accountNameField = document.getElementById('account_name');
            const accountNumberField = document.getElementById('account_number');
            
            bankNameField.required = true;
            bankNameField.disabled = false;
            accountNameField.required = true;
            accountNameField.disabled = false;
            accountNumberField.required = true;
            accountNumberField.disabled = false;
            
            // Remove required from mobile money fields and disable them
            const mobileCompanyField = document.getElementById('mobile_money_company');
            const accountNameMobileField = document.getElementById('account_name_mobile');
            const accountNumberMobileField = document.getElementById('account_number_mobile');
            
            mobileCompanyField.required = false;
            mobileCompanyField.disabled = true;
            accountNameMobileField.required = false;
            accountNameMobileField.disabled = true;
            accountNumberMobileField.required = false;
            accountNumberMobileField.disabled = true;
            
            // Clear mobile money fields
            mobileCompanyField.value = '';
            accountNameMobileField.value = '';
            accountNumberMobileField.value = '';
        } else if (mobileRadio.checked) {
            bankSection.classList.add('hidden');
            mobileSection.classList.remove('hidden');
            
            // Set required fields for mobile money and enable them
            const mobileCompanyField = document.getElementById('mobile_money_company');
            const accountNameMobileField = document.getElementById('account_name_mobile');
            const accountNumberMobileField = document.getElementById('account_number_mobile');
            
            mobileCompanyField.required = true;
            mobileCompanyField.disabled = false;
            accountNameMobileField.required = true;
            accountNameMobileField.disabled = false;
            accountNumberMobileField.required = true;
            accountNumberMobileField.disabled = false;
            
            // Remove required from bank fields and disable them
            const bankNameField = document.getElementById('bank_name');
            const accountNameField = document.getElementById('account_name');
            const accountNumberField = document.getElementById('account_number');
            
            bankNameField.required = false;
            bankNameField.disabled = true;
            accountNameField.required = false;
            accountNameField.disabled = true;
            accountNumberField.required = false;
            accountNumberField.disabled = true;
            
            // Clear bank fields
            bankNameField.value = '';
            accountNameField.value = '';
            accountNumberField.value = '';
        }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Initially disable all payment fields
        document.getElementById('bank_name').disabled = true;
        document.getElementById('account_name').disabled = true;
        document.getElementById('account_number').disabled = true;
        document.getElementById('mobile_money_company').disabled = true;
        document.getElementById('account_name_mobile').disabled = true;
        document.getElementById('account_number_mobile').disabled = true;
        
        // Then handle payment method change if one is selected
        handlePaymentMethodChange();
    });

</script>
{% endblock %}

